---
import Layout from '../layouts/Layout.astro';
import { getEntry } from 'astro:content';
import yaml from 'js-yaml';
import fs from 'node:fs';
import path from 'node:path';

// Load manifesto content
const manifesto = await getEntry('manifesto', 'index');
const { Content } = await manifesto.render();

// Load signatories
const signatoriesPath = path.join(process.cwd(), 'src/data/signatories.yaml');
const signatoriesFile = fs.readFileSync(signatoriesPath, 'utf-8');
const signatoriesData = yaml.load(signatoriesFile) as { signatories: Array<{
  name: string;
  url?: string;
  title?: string;
  org?: string;
}> };

const signatories = signatoriesData.signatories || [];
---

<Layout title={`${manifesto.data.title} - A Manifesto`}>
  <!-- Hero Section -->
  <section class="py-16 sm:py-24 px-4 sm:px-6 text-center">
    <div class="max-w-3xl mx-auto">
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight mb-4">
        Use What <span class="text-primary">Works</span>
      </h1>
      <p class="text-xl sm:text-2xl text-text-offset mb-8">
        {manifesto.data.tagline}
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <a
          href="#manifesto"
          class="px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:opacity-90 transition-opacity"
        >
          Read the Manifesto
        </a>
        <a
          href="#sign"
          class="px-6 py-3 border border-border text-text font-semibold rounded-lg hover:bg-background-offset transition-colors"
        >
          Sign It
        </a>
      </div>
    </div>
  </section>

  <!-- Divider -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6">
    <hr class="border-border" />
  </div>

  <!-- Manifesto Section -->
  <section id="manifesto" class="py-16 px-4 sm:px-6">
    <article class="prose">
      <Content />
    </article>
  </section>

  <!-- Divider -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6">
    <hr class="border-border" />
  </div>

  <!-- Signatories Section -->
  <section id="sign" class="py-16 px-4 sm:px-6">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-10">
        <h2 class="text-2xl sm:text-3xl font-bold mb-2">Signatories</h2>
        <p class="text-text-offset">
          {signatories.length} {signatories.length === 1 ? 'person has' : 'people have'} signed this manifesto
        </p>
      </div>

      <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-12">
        {signatories.map((person) => (
          <li class="p-4 bg-background-offset rounded-lg border border-border">
            {person.url ? (
              <a
                href={person.url}
                target="_blank"
                rel="noopener"
                class="font-semibold text-primary hover:underline"
              >
                {person.name}
              </a>
            ) : (
              <span class="font-semibold">{person.name}</span>
            )}
            {(person.title || person.org) && (
              <p class="text-sm text-text-offset mt-1">
                {person.title}{person.title && person.org && ' at '}{person.org}
              </p>
            )}
          </li>
        ))}
      </ul>

      <!-- CTA -->
      <div class="text-center p-8 bg-background-offset rounded-xl border border-border">
        <h3 class="text-xl font-bold mb-2">Sign the Manifesto</h3>
        <p class="text-text-offset mb-6">
          Add your name by submitting a pull request on GitHub.
        </p>
        <a
          href="https://github.com/UseWhatWorks/website/edit/main/src/data/signatories.yaml"
          class="inline-block px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:opacity-90 transition-opacity"
        >
          Add Your Signature
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  .prose {
    @apply max-w-3xl mx-auto;
  }

  .prose :global(blockquote) {
    @apply text-xl sm:text-2xl text-text-offset italic border-l-4 border-primary pl-6 my-8;
  }

  .prose :global(h2) {
    @apply text-2xl sm:text-3xl font-bold mt-12 mb-6;
  }

  .prose :global(h3) {
    @apply text-lg font-semibold text-primary mb-2 mt-8;
  }

  .prose :global(p) {
    @apply text-text-offset leading-relaxed mb-4;
  }

  .prose :global(a:not(.discuss-link)) {
    @apply text-primary underline underline-offset-2 hover:decoration-primary transition-colors;
    text-decoration-color: color-mix(in srgb, var(--color-primary) 30%, transparent);
  }

  .prose :global(a:not(.discuss-link):hover) {
    text-decoration-color: var(--color-primary);
  }

  .prose :global(.discuss-link) {
    @apply inline-flex items-center ml-2 text-text-offset hover:text-primary transition-colors no-underline align-middle;
  }

  .prose :global(.discuss-link svg) {
    @apply w-5 h-5;
    stroke-width: 2.5;
  }

  .prose :global(ul) {
    @apply space-y-3 text-text-offset my-6;
  }

  .prose :global(li) {
    @apply flex items-start gap-3;
  }

  .prose :global(li::before) {
    content: "-";
    @apply text-primary;
  }

  .prose :global(hr) {
    @apply border-border my-12;
  }
</style>
